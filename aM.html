<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Airline Manager -- Deluxe (Map + Log + Repair)</title>
<style>
  :root{
    --bg1:#07162b; --bg2:#05213f; --panel:#0b335d; --accent:#1e90ff; --muted:#bcd8ff;
  }
  html,body{height:100%; margin:0; font-family:Inter,Arial,Helvetica,sans-serif; background:linear-gradient(180deg,var(--bg1),var(--bg2)); color:#eaf4ff}
  header{display:flex;gap:12px;align-items:center;padding:12px;position:sticky;top:0;background:linear-gradient(90deg,rgba(0,0,0,0.12),rgba(255,255,255,0.02));box-shadow:0 2px 8px rgba(0,0,0,0.3);z-index:40}
  h1{margin:0;font-size:18px}
  #topRight{margin-left:auto;display:flex;gap:8px;align-items:center}
  input,select,button{font-size:14px;padding:8px;border-radius:8px;border:0;outline:none}
  button{background:var(--accent);color:white;cursor:pointer}
  button.secondary{background:rgba(255,255,255,0.06); color:var(--muted)}
  main{display:grid;grid-template-columns: 1fr 420px; gap:12px;padding:12px;max-width:1300px;margin:0 auto}
  #mapCard{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.08));border-radius:12px;padding:8px;min-height:520px}
  #side{display:flex;flex-direction:column;gap:12px}
  .panel{background:rgba(255,255,255,0.03); border-radius:12px;padding:10px;box-shadow:0 6px 18px rgba(0,0,0,0.4)}
  #fleetList{display:flex;flex-direction:column;gap:8px;max-height:280px;overflow:auto}
  .planeRow{display:flex;gap:8px;align-items:center;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
  .pill{background:rgba(255,255,255,0.03);padding:4px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
  canvas#map{width:100%;height:480px;border-radius:8px;display:block;background:linear-gradient(#0b2b51,#06304e)}
  #log{height:160px;overflow:auto;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px;color:var(--muted)}
  footer{padding:12px;text-align:center;color:var(--muted)}
  /* responsive */
  @media (max-width:980px){ main{grid-template-columns:1fr; padding:10px} canvas#map{height:320px} }
</style>
</head>
<body>
<header>
  <h1>Airline Manager -- Deluxe</h1>

  <div id="startupFields" style="display:flex;gap:8px;align-items:center;margin-left:12px">
    <input id="companyName" placeholder="–ù–∞–∑–≤–∞ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó" style="width:220px"/>
    <select id="baseSelect">
      <option value="">–û–±–µ—Ä—ñ—Ç—å –±–∞–∑—É</option>
    </select>
    <button id="startBtn">–°—Ç–∞—Ä—Ç</button>
  </div>

  <div id="topRight">
    <div class="muted">–ë–∞–ª–∞–Ω—Å: $<span id="money">1,000,000</span></div>
    <div class="muted">–ö–æ–º–ø–∞–Ω—ñ—è: <strong id="companyLabel">--</strong></div>
  </div>
</header>

<main>
  <div id="mapCard" class="panel">
    <canvas id="map"></canvas>
    <div style="display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap">
      <div class="small muted">–õ–µ–≥–µ–Ω–¥–∞:</div>
      <div class="pill">üü¢ –∞–∫—Ç–∏–≤–Ω–∏–π</div>
      <div class="pill" style="background:#ff9933;color:#3b1d00">üü† –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π</div>
      <div class="pill" style="background:#ffd400;color:#3b1d00">üü° –≤ —Ä–µ–º–æ–Ω—Ç—ñ</div>
      <div class="pill" style="background:#ff6b6b;color:#3b1d00">üî¥ –≤—Ç—Ä–∞—á–µ–Ω–∏–π</div>
    </div>
  </div>

  <aside id="side">
    <div class="panel">
      <div style="display:flex;gap:8px;align-items:center">
        <select id="aircraftCatalog"></select>
        <button id="buyBtn">–ö—É–ø–∏—Ç–∏</button>
      </div>
      <div class="small muted" style="margin-top:8px">–ö—É–ø—ñ—Ç—å –ª—ñ—Ç–∞–∫ -- –≤—ñ–Ω –∑ º—è–≤–∏—Ç—å—Å—è —É —Ñ–ª–æ—Ç—ñ. –ú–∞–ª–µ–Ω—å–∫—ñ –ª—ñ—Ç–∞–∫–∏ –Ω–µ –¥–æ–ª—ñ—Ç–∞—é—Ç—å –¥–æ –¥–∞–ª–µ–∫–∏—Ö –Ω–∞–ø—Ä—è–º–∫—ñ–≤.</div>
    </div>

    <div class="panel">
      <h3 style="margin:0 0 8px 0">–§–ª–æ—Ç</h3>
      <div id="fleetList"></div>
    </div>

    <div class="panel">
      <h3 style="margin:0 0 8px 0">–ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</h3>
      <div id="log"></div>
    </div>
  </aside>
</main>

<footer>–°–∏–º—É–ª—è—Ü—ñ—è –ª–æ–∫–∞–ª—å–Ω–∞ -- –≤—Å–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –ø–∞–º'—è—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏.</footer>

<script>
/* ====== –ö–æ–Ω—Ñ—ñ–≥ —ñ –¥–∞–Ω—ñ ====== */
const STARTING_CASH = 1000000;
let money = STARTING_CASH;
let companyName = "";
let base = "";

const aircraftCatalog = {
  L410:  { name:"Let L-410",       price:250000,  range:  800, seats:19 },
  Q400:  { name:"Dash 8 Q400",     price:450000,  range: 1400, seats:78 },
  ATR72: { name:"ATR-72",          price:500000,  range: 1500, seats:72 },
  CRJ9:  { name:"CRJ-900",         price:600000,  range: 2500, seats:90 },
  E190:  { name:"Embraer E190",    price:700000,  range: 3000, seats:100 },
  A320:  { name:"Airbus A320",     price:900000,  range: 5000, seats:150 },
  B737:  { name:"Boeing 737-800",  price:950000,  range: 5500, seats:160 },
  A321N: { name:"Airbus A321neo",  price:1200000, range: 6500, seats:200 },
  A330:  { name:"Airbus A330",     price:1400000, range:12000, seats:260 },
  B787:  { name:"Boeing 787",      price:2000000, range:15500, seats:280 },
  A350:  { name:"Airbus A350",     price:2400000, range:16000, seats:300 },
  B77X:  { name:"Boeing 777X",     price:2800000, range:17500, seats:350 }
};

const airports = {
  KBP:{name:"–ö–∏—ó–≤ (KBP)", x:0.63,y:0.38},
  LWO:{name:"–õ—å–≤—ñ–≤ (LWO)", x:0.59,y:0.37},
  ODS:{name:"–û–¥–µ—Å–∞ (ODS)", x:0.64,y:0.45},
  HRK:{name:"–•–∞—Ä–∫—ñ–≤ (HRK)",x:0.68,y:0.40},
  DNK:{name:"–î–Ω—ñ–ø—Ä–æ (DNK)",x:0.66,y:0.42},

  WAR:{name:"–í–∞—Ä—à–∞–≤–∞", x:0.57,y:0.35, distance:800},
  BER:{name:"–ë–µ—Ä–ª—ñ–Ω",  x:0.54,y:0.35, distance:1300},
  LON:{name:"–õ–æ–Ω–¥–æ–Ω",  x:0.48,y:0.33, distance:2400},
  PAR:{name:"–ü–∞—Ä–∏–∂",   x:0.50,y:0.35, distance:2300},
  MAD:{name:"–ú–∞–¥—Ä–∏–¥",  x:0.47,y:0.38, distance:2700},
  ROM:{name:"–†–∏–º",     x:0.56,y:0.43, distance:1800},
  IST:{name:"–°—Ç–∞–º–±—É–ª", x:0.64,y:0.48, distance:1050},
  DXB:{name:"–î—É–±–∞–π",   x:0.74,y:0.56, distance:3500},
  DOH:{name:"–î–æ—Ö–∞",    x:0.73,y:0.57, distance:3600},
  CAI:{name:"–ö–∞—ó—Ä",    x:0.63,y:0.57, distance:2600},
  JFK:{name:"–ù—å—é-–ô–æ—Ä–∫",x:0.18,y:0.40, distance:7500},
  NRT:{name:"–¢–æ–∫—ñ–æ",   x:0.93,y:0.45, distance:8200},
  HKG:{name:"–ì–æ–Ω–∫–æ–Ω–≥", x:0.88,y:0.55, distance:7800},
  SYD:{name:"–°—ñ–¥–Ω–µ–π",  x:0.95,y:0.86, distance:15000},
  SIN:{name:"–°—ñ–Ω–≥–∞–ø—É—Ä",x:0.86,y:0.66, distance:9000},
  LAX:{name:"–õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å",x:0.08,y:0.46,distance:10000}
};

// –ø—Ä–∏–±—É—Ç–æ–∫ ~ –≤—ñ–¥ distance * –∫–æ–µ—Ñ
function profitFor(distanceKm){ return Math.round(distanceKm * 120); } // 800km ~ 96k

// —á–∞—Å –ø–æ–ª—å–æ—Ç—É: 800 km = 5s
function flightTimeMs(distanceKm){ return Math.max(1000, (distanceKm/800) * 5000); }

/* ====== –°—Ç–∞–Ω –≥—Ä–∏ ====== */
let fleet = []; // –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤ –ª—ñ—Ç–∞–∫—ñ–≤
// –ª—ñ—Ç–∞–∫: {id,type,name,range,seats,price,route,status,progress,timer,damage}

const logEl = document.getElementById('log');
const moneyEl = document.getElementById('money');
const companyLabel = document.getElementById('companyLabel');

/* ====== UI —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ====== */
const baseSelect = document.getElementById('baseSelect');
Object.entries(airports).forEach(([code,a])=>{
  // only show bases with no distance? We want both base candidates and destinations.
  // put local bases first
  const opt = document.createElement('option'); opt.value = code; opt.textContent = a.name + (a.distance ? ` -- ${a.distance}–∫–º` : '');
  baseSelect.appendChild(opt);
});

const acCatalogSel = document.getElementById('aircraftCatalog');
Object.entries(aircraftCatalog).forEach(([code,a])=>{
  const o = document.createElement('option'); o.value=code;
  o.textContent = `${a.name} -- $${a.price.toLocaleString()} ‚Ä¢ ${a.range}–∫–º ‚Ä¢ ${a.seats} –º—ñ—Å—Ü—å`;
  acCatalogSel.appendChild(o);
});

document.getElementById('startBtn').addEventListener('click', ()=>{
  const nm = document.getElementById('companyName').value.trim();
  const b = baseSelect.value;
  if(!nm) return alert('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó');
  if(!b) return alert('–û–±–µ—Ä—ñ—Ç—å –±–∞–∑—É');
  companyName = nm; base = b;
  companyLabel.textContent = companyName;
  document.getElementById('startupFields').style.display = 'none';
  pushLog(`–ì—Ä–∞ —Ä–æ–∑–ø–æ—á–∞—Ç–∞ -- ${companyName}, –±–∞–∑–∞ ${airports[base].name}`);
  renderFleetUI();
});

/* –∫—É–ø–∏—Ç–∏ */
document.getElementById('buyBtn').addEventListener('click', ()=>{
  const type = acCatalogSel.value;
  if(!type) return alert('–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –ª—ñ—Ç–∞–∫–∞');
  const spec = aircraftCatalog[type];
  if(money < spec.price) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤');
  money -= spec.price; updateMoney();
  const plane = {
    id: Date.now() + Math.floor(Math.random()*9999),
    type, name: spec.name, range: spec.range, seats: spec.seats, price: spec.price,
    route: "", status:"idle", progress:0, timer:null, damage:null,
    map:{from:base,to:"",t:0}
  };
  fleet.push(plane);
  pushLog(`–ö—É–ø–ª–µ–Ω–æ ${plane.name} (${plane.type}) –∑–∞ $${spec.price.toLocaleString()}`);
  renderFleetUI();
});

/* ====== –ü–æ–¥—ñ—ó / –∂—É—Ä–Ω–∞–ª ====== */
function pushLog(text){
  const t = new Date();
  const hh = t.getHours().toString().padStart(2,'0');
  const mm = t.getMinutes().toString().padStart(2,'0');
  const ss = t.getSeconds().toString().padStart(2,'0');
  const line = `${hh}:${mm}:${ss} -- ${text}`;
  const div = document.createElement('div'); div.textContent = line;
  logEl.prepend(div);
  // trim
  while(logEl.childNodes.length > 400) logEl.removeChild(logEl.lastChild);
}

/* ====== –ü–æ–ª—å–æ—Ç–∏ —ñ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∏ ====== */
function rollIncident(){
  const r = Math.random();
  if (r < 0.82) return null;
  const types = ["–í—ñ–¥–º–æ–≤–∞ –¥–≤–∏–≥—É–Ω–∞","–ì—ñ–¥—Ä–æ—Å–∏—Å—Ç–µ–º–∞","–ü–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è —à–∞—Å—ñ","–ï–ª–µ–∫—Ç—Ä–æ—Å–∏—Å—Ç–µ–º–∞","Bird strike","–î–µ–∫–æ–º–ø—Ä–µ—Å—ñ—è"];
  const type = types[Math.floor(Math.random()*types.length)];
  if (r < 0.96){
    const severity = Math.random() < 0.7 ? "–Ω–µ–∑–Ω–∞—á–Ω–∞" : "—Å–µ—Ä–π–æ–∑–Ω–∞";
    return {type, severity, crash:false};
  }
  return {type, severity:"–∫—Ä–∏—Ç–∏—á–Ω–∞", crash:true};
}

function startAutoFlight(plane){
  if(!plane.route || plane.status==="lost" || plane.status==="repair" || plane.status==="damaged") return;
  const ap = airports[plane.route];
  if(!ap || !ap.distance) { pushLog(`${plane.name}: –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç`); return; }
  if(ap.distance > plane.range){ pushLog(`${plane.name}: –Ω–µ –º–æ–∂–µ –¥–æ–ª–µ—Ç—ñ—Ç–∏ –¥–æ ${ap.name}`); return; }

  plane.status = "flying";
  plane.progress = 0;
  plane.map.from = base; plane.map.to = plane.route; plane.map.t = 0;
  const dur = flightTimeMs(ap.distance);
  const stepMs = 100;
  const steps = Math.max(1, Math.floor(dur/stepMs));
  const inc = 100/steps;

  clearInterval(plane.timer);
  plane.timer = setInterval(()=>{
    if(plane.status !== "flying"){ clearInterval(plane.timer); return; }
    plane.progress += inc;
    plane.map.t = Math.min(1, plane.progress/100);
    updatePlaneBar(plane.id, plane.progress);
    if(plane.progress >= 100){
      clearInterval(plane.timer);
      plane.progress = 100; updatePlaneBar(plane.id,100);
      const incident = rollIncident();
      if(incident && incident.crash){
        plane.status="lost";
        pushLog(`üí• –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞: ${plane.name} –Ω–∞ –º–∞—Ä—à—Ä—É—Ç—ñ ${airports[plane.route].name} -- ${incident.type} (–∫—Ä–∏—Ç–∏—á–Ω–∞). –õ—ñ—Ç–∞–∫ –≤—Ç—Ä–∞—á–µ–Ω–æ.`);
        // –ø—Ä–∏–±—Ä–∞—Ç–∏ –ª—ñ—Ç–∞–∫
        fleet = fleet.filter(p=>p.id!==plane.id);
        renderFleetUI();
        return;
      }
      if(incident){
        // –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è
        const baseCost = plane.price || 1000000;
        const repairCost = incident.severity==="–Ω–µ–∑–Ω–∞—á–Ω–∞" ? Math.round(baseCost*0.1) : Math.round(baseCost*0.25);
        const repairTimeSec = incident.severity==="–Ω–µ–∑–Ω–∞—á–Ω–∞" ? 8 : 18;
        plane.status="damaged";
        plane.damage = { type:incident.type, severity:incident.severity, repairCost, repairTimeSec, until:0 };
        pushLog(`üö® ${plane.name} –ø–æ—à–∫–æ–¥–∂–µ–Ω–æ (${incident.type}, ${incident.severity}). –†–µ–º–æ–Ω—Ç $${repairCost.toLocaleString()} (${repairTimeSec}s)`);
        renderFleetUI();
        return;
      }
      // —É—Å–ø—ñ—à–Ω–∏–π —Ä–µ–π—Å
      const prof = profitFor(ap.distance);
      money += prof; updateMoney();
      pushLog(`‚úàÔ∏è ${plane.name} –∑–∞–≤–µ—Ä—à–∏–≤ —Ä–µ–π—Å ${airports[plane.route].name} -- –ø—Ä–∏–±—É—Ç–æ–∫ $${prof.toLocaleString()}`);
      plane.progress = 0; plane.map.t = 0;
      // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–∞—Ä—Ç—É—î –∑–Ω–æ–≤—É
      setTimeout(()=>{ if(plane.status === "flying" || plane.status === "idle") startAutoFlight(plane); }, 600);
    }
  }, stepMs);
}

/* –†–µ–º–æ–Ω—Ç */
function beginRepair(plane){
  if(!plane.damage) return alert('–ù–µ–º–∞—î –ø–æ—à–∫–æ–¥–∂–µ–Ω—å');
  if(money < plane.damage.repairCost) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–µ–º–æ–Ω—Ç');
  money -= plane.damage.repairCost; updateMoney();
  plane.status = "repair";
  const until = Date.now() + plane.damage.repairTimeSec*1000;
  plane.damage.until = until;
  pushLog(`üîß –†–µ–º–æ–Ω—Ç ${plane.name} —Ä–æ–∑–ø–æ—á–∞—Ç–æ -- $${plane.damage.repairCost.toLocaleString()} (${plane.damage.repairTimeSec}s)`);
  renderFleetUI();

  const tick = setInterval(()=>{
    const left = Math.max(0, Math.ceil((until - Date.now())/1000));
    const el = document.getElementById(`repairLeft-${plane.id}`);
    if(el) el.textContent = `${left}s`;
    if(left <= 0){
      clearInterval(tick);
      plane.status = "idle";
      plane.damage = null;
      plane.progress = 0;
      pushLog(`‚úÖ –†–µ–º–æ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${plane.name}`);
      renderFleetUI();
      if(plane.route) startAutoFlight(plane);
    }
  }, 300);
}

/* –ü—Ä–æ–¥–∞—Ç–∏ */
function sellPlane(plane){
  if(!confirm(`–ü—Ä–æ–¥–∞—Ç–∏ ${plane.name} –∑–∞ $${Math.round((plane.price||0)*0.5).toLocaleString()}?`)) return;
  money += Math.round((plane.price||0)*0.5); updateMoney();
  fleet = fleet.filter(p=>p.id!==plane.id);
  pushLog(`–ü—Ä–æ–¥–∞–Ω–æ ${plane.name} (50% –≤—ñ–¥ —Ü—ñ–Ω–∏)`);
  renderFleetUI();
}

/* ====== UI —Ä–µ–Ω–¥–µ—Ä —Ñ–ª–æ—Ç—É ====== */
function renderFleetUI(){
  const container = document.getElementById('fleetList');
  container.innerHTML = "";
  fleet.forEach(plane=>{
    const div = document.createElement('div'); div.className='planeRow';
    const statusText = plane.status==="flying" ? '—É –ø–æ–ª—å–æ—Ç—ñ' : plane.status==="damaged" ? '–ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π' : plane.status==="repair" ? '–≤ —Ä–µ–º–æ–Ω—Ç—ñ' : '–Ω–∞ –±–∞–∑—ñ';
    div.innerHTML = `
      <div style="flex:1">
        <div style="display:flex;gap:8px;align-items:center">
          <strong>${plane.name}</strong>
          <span class="pill">${plane.range}–∫–º</span>
        </div>
        <div class="small muted">–°—Ç–∞—Ç—É—Å: <strong>${statusText}</strong></div>
        <div style="margin-top:6px;display:flex;gap:6px;align-items:center">
          <select id="route-${plane.id}" style="min-width:170px">
            <option value="">-- –æ–±—Ä–∞—Ç–∏ –Ω–∞–ø—Ä—è–º–æ–∫ --</option>
            ${Object.entries(airports).filter(([k,a])=>a.distance).map(([k,a])=>{
              const disabled = a.distance > plane.range ? 'disabled' : '';
              return `<option value="${k}" ${plane.route===k?'selected':''} ${disabled}>${a.name} -- ${a.distance}–∫–º -- –ø—Ä–∏–±: $${profitFor(a.distance).toLocaleString()}</option>`;
            }).join('')}
          </select>
          <button id="repair-${plane.id}" class="secondary">–†–µ–º–æ–Ω—Ç</button>
          <button id="sell-${plane.id}" class="secondary">–ü—Ä–æ–¥–∞—Ç–∏</button>
        </div>
        <div style="height:8px;background:rgba(255,255,255,0.06);border-radius:6px;margin-top:6px;overflow:hidden">
          <div id="bar-${plane.id}" style="height:100%;width:${plane.progress}%;background:${plane.status==='flying'?'limegreen':plane.status==='damaged'?'#ff9933':plane.status==='repair'?'#ffd400':'#6aa1ff'}"></div>
        </div>
        ${plane.status==='damaged' && plane.damage ? `<div class="small muted">üö® ${plane.damage.type} (${plane.damage.severity}) -- —Ä–µ–º–æ–Ω—Ç $${plane.damage.repairCost.toLocaleString()} ‚Ä¢ <span id="repairLeft-${plane.id}">${plane.damage.repairTimeSec}s</span></div>` : ''}
      </div>
    `;
    container.appendChild(div);

    // events
    const routeSel = div.querySelector(`#route-${plane.id}`);
    routeSel.addEventListener('change', ()=>{
      const code = routeSel.value;
      if(!code){ plane.route=""; plane.progress=0; plane.status="idle"; updatePlaneBar(plane.id,0); return; }
      const ap = airports[code];
      if(!ap || !ap.distance){ alert('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç'); return; }
      if(ap.distance > plane.range){ alert(`${plane.name} –Ω–µ –¥–æ–ª–µ—Ç–∏—Ç—å (${ap.distance}–∫–º > ${plane.range}–∫–º)`); routeSel.value=''; return; }
      plane.route = code;
      pushLog(`${plane.name} –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç ${airports[code].name} (${ap.distance}–∫–º)`);
      if(plane.status === 'idle') startAutoFlight(plane);
      renderFleetUI();
    });

    const repairBtn = div.querySelector(`#repair-${plane.id}`);
    repairBtn.addEventListener('click', ()=> {
      if(!plane.damage) return alert('–ù–µ–º–∞—î –ø–æ—à–∫–æ–¥–∂–µ–Ω—å');
      if(plane.status==='repair') return alert('–í–∂–µ –≤ —Ä–µ–º–æ–Ω—Ç—ñ');
      beginRepair(plane);
    });

    const sellBtn = div.querySelector(`#sell-${plane.id}`);
    sellBtn.addEventListener('click', ()=> sellPlane(plane));
  });
}

/* –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞—Ä—É */
function updatePlaneBar(id,pct){
  const el = document.getElementById(`bar-${id}`);
  if(el) el.style.width = Math.min(100, Math.max(0, pct)) + '%';
}

/* –æ–Ω–æ–≤–∏—Ç–∏ –≥—Ä–æ—à—ñ */
function updateMoney(){ moneyEl.textContent = money.toLocaleString(); }

/* ====== –ö–∞—Ä—Ç–∞: –≤—ñ–¥–º–∞–ª—é–≤–∞—Ç–∏ –ª—ñ—Ç–∞–∫–∏ —Ç–∞ –∞–µ—Ä–æ–ø–æ—Ä—Ç–∏ ====== */
const canvas = document.getElementById('map');
const ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = canvas.clientWidth * devicePixelRatio; canvas.height = canvas.clientHeight * devicePixelRatio; ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0); }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function draw(){
  // —Ñ–æ–Ω
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const w = canvas.clientWidth, h = canvas.clientHeight;

  // –ø—Ä–æ—Å—Ç–∏–π –º–∞—Ç—Ä–∏–∫—Å –º–∞—Ç–µ—Ä–∏–∫—ñ–≤ (—Ü—ñ–ª—å - –≤–∏–≥–ª—è–¥–Ω–æ)
  ctx.fillStyle = '#0b3056';
  ctx.fillRect(0,0,w,h);

  // draw airports (destinations with distance)
  Object.entries(airports).forEach(([code,a])=>{
    const x = a.x * w, y = a.y * h;
    // dot
    ctx.beginPath(); ctx.fillStyle = a.distance ? '#ffd400' : '#79c7ff'; ctx.arc(x,y,4,0,Math.PI*2); ctx.fill();
    // label (small)
    ctx.fillStyle = '#fff'; ctx.font = '12px Arial';
    ctx.fillText(a.name, x + 6, y - 6);
  });

  // draw lines from base to destinations
  const b = airports[base];
  if(b){
    const bx = b.x * w, by = b.y * h;
    ctx.strokeStyle = 'rgba(255,255,255,0.08)'; ctx.lineWidth = 1;
    Object.entries(airports).forEach(([code,a])=>{
      if(!a.distance) return;
      const ax = a.x*w, ay = a.y*h;
      ctx.beginPath(); ctx.moveTo(bx,by); ctx.lineTo(ax,ay); ctx.stroke();
    });
  }

  // draw planes as moving dots
  fleet.forEach(p=>{
    if(!p.route) return;
    const from = airports[p.map.from] || airports[base];
    const to = airports[p.map.to];
    const fx = (from.x || 0.6) * w, fy = (from.y || 0.4) * h;
    const tx = (to.x || 0.6) * w, ty = (to.y || 0.4) * h;
    const t = p.map.t || (p.progress/100) || 0;
    const x = fx + (tx-fx) * t;
    const y = fy + (ty-fy) * t;
    ctx.beginPath();
    ctx.fillStyle = p.status === 'damaged' ? '#ff9933' : p.status === 'repair' ? '#ffd400' : '#00ff9c';
    ctx.arc(x,y,6,0,Math.PI*2); ctx.fill();
    ctx.fillStyle = '#002'; ctx.font = '10px Arial';
    ctx.fillText(p.type, x+8, y+4);
  });

  requestAnimationFrame(draw);
}
requestAnimationFrame(draw);

/* ====== init UI render ====== */
updateMoney();
renderFleetUI();
pushLog('–ì–æ—Ç–æ–≤–æ -- –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–æ–º–ø–∞–Ω—ñ—ó —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –±–∞–∑—É —â–æ–± –ø–æ—á–∞—Ç–∏');
</script>
</body>
</html>
